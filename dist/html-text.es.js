/*!
 * @pixi/text-html - v1.0.0
 * Compiled Mon, 06 Apr 2020 18:56:02 UTC
 *
 * @pixi/text-html is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
import{Sprite as t}from"@pixi/sprite";import{settings as i}from"@pixi/settings";import{Texture as e}from"@pixi/core";import{Rectangle as o}from"@pixi/math";import{trimCanvas as s,sign as r}from"@pixi/utils";import{TextStyle as n}from"@pixi/text";var h=function(t){function h(s,r,n){if(void 0===s&&(s=""),void 0===r&&(r={}),"undefined"==typeof btoa)throw new Error("Your browser doesn't support base64 conversions.");(n=n||document.createElement("canvas")).width=3,n.height=3;var h=e.from(n,{scaleMode:i.SCALE_MODE});h.orig=new o,h.trim=new o,t.call(this,h),this._parser=new DOMParser,this._image=new Image,this.canvas=n,this.context=this.canvas.getContext("2d"),this._resolution=i.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._loading=!1,this.text=s,this.style=r,this.localStyleID=-1}t&&(h.__proto__=t),h.prototype=Object.create(t&&t.prototype),h.prototype.constructor=h;var a={width:{configurable:!0},height:{configurable:!0},style:{configurable:!0},text:{configurable:!0},resolution:{configurable:!0}};return h.prototype.updateText=function(t){var i=this,e=this.style,o=this.canvas,s=this.context,r=this.resolution;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),this.dirty||!t){var n="\n            display:inline-block;\n            color:"+e.fill+";\n            font-size: "+e.fontSize+"px;\n            font-family:"+e.fontFamily+";\n            font-weight:"+e.fontWeight+";\n            font-style:"+e.fontStyle+";\n            font-variant:"+e.fontVariant+";\n            letter-spacing:"+e.letterSpacing+"px;\n            text-align:"+e.align+";\n            padding:"+e.padding+"px;\n        ";if(e.breakWords&&(n+="word-break:break-all;"),e.lineHeight&&(n+="line-height:"+e.lineHeight+"px;"),e.wordWrap&&(n+="word-wrap:break-word;",n+="width:"+e.wordWrapWidth+"px;"),e.strokeThickness&&(n+="-webkit-text-stroke-width: "+e.strokeThickness+"px;",n+="-webkit-text-stroke-color: "+e.stroke+";",n+="text-stroke-width: "+e.strokeThickness+"px;",n+="text-stroke-color: "+e.stroke+";"),e.dropShadow)n+="text-shadow: "+Math.round(Math.cos(e.dropShadowAngle)*e.dropShadowDistance)+"px "+Math.round(Math.sin(e.dropShadowAngle)*e.dropShadowDistance)+"px "+e.dropShadowBlur+"px "+e.dropShadowColor+";";var h='\n            <svg xmlns="http://www.w3.org/2000/svg" width="2048" height="2048">\n                <foreignObject width="100%" height="100%">\n                    <div xmlns="http://www.w3.org/1999/xhtml" style="'+n+'">'+this._text+"</div>\n                </foreignObject>\n            </svg>\n       ",a=this._parser.parseFromString(h,"text/xml").firstChild.querySelector("div");document.body.appendChild(a);var l=a.getBoundingClientRect(),d=l.width,u=l.height;if(document.body.removeChild(a),o.width=Math.ceil((Math.max(1,d)+2*e.padding)*r),o.height=Math.ceil((Math.max(1,u)+2*e.padding)*r),s.scale(r,r),s.clearRect(0,0,o.width,o.height),!this._loading){var p=this._image;this._loading=!0,p.src="data:image/svg+xml;base64,"+btoa(h),p.onload=function(){s.drawImage(p,0,0,d,u,0,0,d,u),p.onload=void 0,p.src="",i._loading=!1,i.updateTexture()},this.updateTexture()}}},h.prototype.updateTexture=function(){var t=this.canvas,i=this.context,e=this.style,o=this.texture,r=this.resolution;if(e.trim){var n=s(t);t.width=n.width,t.height=n.height,i.putImageData(n.data,0,0)}var h=e.trim?0:e.padding,a=o.baseTexture;o.trim.width=o._frame.width=Math.ceil(t.width/r),o.trim.height=o._frame.height=Math.ceil(t.height/r),o.trim.x=-h,o.trim.y=-h,o.orig.width=o._frame.width-2*h,o.orig.height=o._frame.height-2*h,this._onTextureUpdate(),a.setRealSize(t.width,t.height,r),this.dirty=!1},h.prototype._render=function(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),t.prototype._render.call(this,i)},h.prototype._renderCanvas=function(i){this._autoResolution&&this._resolution!==i.resolution&&(this._resolution=i.resolution,this.dirty=!0),this.updateText(!0),t.prototype._renderCanvas.call(this,i)},h.prototype.getLocalBounds=function(i){return this.updateText(!0),t.prototype.getLocalBounds.call(this,i)},h.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},h.prototype._onStyleChange=function(){this.dirty=!0},h.prototype.destroy=function(i){void 0===i&&(i=!0),t.prototype.destroy.call(this,i),this.context=null,this.canvas.width=this.canvas.height=0,this.canvas=null,this._style=null},a.width.get=function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},a.width.set=function(t){this.updateText(!0);var i=r(this.scale.x)||1;this.scale.x=i*t/this._texture.orig.width,this._width=t},a.height.get=function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},a.height.set=function(t){this.updateText(!0);var i=r(this.scale.y)||1;this.scale.y=i*t/this._texture.orig.height,this._height=t},a.style.get=function(){return this._style},a.style.set=function(t){t=t||{},this._style=t instanceof n?t:new n(t),this.localStyleID=-1,this.dirty=!0},a.text.get=function(){return this._text},a.text.set=function(t){t=String(""===t||null==t?" ":t),this._text!==t&&(this._text=t,this.dirty=!0)},a.resolution.get=function(){return this._resolution},a.resolution.set=function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},Object.defineProperties(h.prototype,a),h}(t);export{h as HTMLText};
//# sourceMappingURL=html-text.es.js.map
